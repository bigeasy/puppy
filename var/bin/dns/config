#!/bin/bash

domain=$1
ip=$(/sbin/ip addr list eth0 | /bin/sed -n 's/^ *inet \([^\/]*\).*$/\1/p')

umask 227
cat <<EOL > /etc/nsd/nsd.conf
server:
    ip-address: ${ip}
    hide-version: yes
    verbosity: 1000
    ip4-only: yes
    identity: ""
    logfile: "/var/log/nsd.log"
    server-count: 1
    pidfile: "/var/lib/nsd/chroot/var/run/nsd/nsd.pid"
    chroot: "/var/lib/nsd/chroot"
    username: nsd
    database: /var/lib/nsd/chroot/var/lib/nsd/nsd.db
    xfrdfile: /var/lib/nsd/chroot/var/lib/nsd/ixfr.state
    difffile: /var/lib/nsd/chroot/var/lib/nsd/ixfr.db
key:
    name: tsig.runpup.com.
    algorithm: hmac-md5
    secret: "iMDmc0DzcOQaD0Y8fFx7Jg=="
zone:
    name: $domain
    zonefile: /var/lib/nsd/chroot/etc/nsd/$domain.zone.signed
EOL
