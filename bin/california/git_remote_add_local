#!/bin/bash

repository=$1
cd $repository

dir=$(/bin/readlink -f "$(/usr/bin/dirname $0)/../..")
. $dir/bin/functions

region=$(echo $HOSTNAME | sed 's/.*\.\([^.]\+\.runpup.com\)/\1/')
UPSTREAM=ssh://$USER@alvar.user.south.$region$dir/.git

/usr/bin/git remote show | /bin/grep '^local$' > /dev/null
if [ $? -ne 0 ]
then
    step "Adding cached repository to $(/bin/basename $repository)." \
        /usr/bin/git remote add local $UPSTREAM
fi
