#!/bin/bash

dir=$(/bin/readlink -f "$(/usr/bin/dirname $0)/../../..")

function maybe_clone()
{
    branch=$1
    if [ ! -e $dir/$branch ]
    then
        cd $dir
        /usr/bin/git clone git@bled.prettyrobots.com:puppy.git $branch
        cd $dir/$branch
        /usr/bin/git checkout -t remotes/origin/$branch
    fi
}

function update_project()
{
    branch=$1
    cd $dir/$branch
    /usr/bin/git pull
}

function deploy()
{
    branch=$1
    /puppy/janitor/bin/deploy $dir/$branch
}

maybe_clone janitor
maybe_clone common
maybe_clone private
maybe_clone protected
maybe_clone public
maybe_clone system
maybe_clone worker
maybe_clone appliances
maybe_clone vhosts
maybe_clone database
maybe_clone client
maybe_clone liminal
maybe_clone exclusive

update_project common
update_project private
update_project protected
update_project public
update_project system
update_project worker
update_project appliances
update_project vhosts
update_project database
update_project client
update_project liminal
update_project janitor
update_project exclusive

$dir/janitor/puppy/janitor/bin/deploy $dir/janitor

deploy system
deploy common
deploy private
deploy protected
deploy public
deploy worker
deploy vhosts
deploy database
deploy liminal
deploy janitor
deploy exclusive
