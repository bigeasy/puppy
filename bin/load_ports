#!/bin/bash

start=$(/bin/awk '{ print $1 }' /proc/sys/net/ipv4/ip_local_port_range)
stop=$(($(/bin/awk '{ print $2 }' /proc/sys/net/ipv4/ip_local_port_range) + 1))

echo "BEGIN"
echo "\\g"

(
    /bin/grep -v '^#' /etc/services | /bin/awk '{ print $2 }' | /bin/grep '[0-9]' | /bin/sed 's/\/.*//' 
    /usr/bin/sudo /usr/sbin/semanage port -l | /bin/sed 1d | puppy/janitor/bin/filter_selinux_ports
    while [ $start -lt $stop ]; do
        echo $start        
        start=$(($start + 1))
    done
) | /bin/sort -n | /usr/bin/uniq | while read line; do
    echo "INSERT INTO ReservedPort(port) VALUES($line)"
    echo "\\g"
done

echo "COMMIT"
echo "\\g"

