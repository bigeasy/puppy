#!/bin/bash

dir=$(/usr/bin/dirname $(/bin/readlink -f $0))

function maybe_clone()
{
    branch=$1
    if [ ! -e $HOME/git/ecma/puppy/$branch ]
    then
        cd $HOME/git/ecma/puppy
        /usr/bin/git clone git@bled.prettyrobots.com:puppy.git $branch
        cd $HOME/git/ecma/puppy/$branch
        /usr/bin/git checkout -t remotes/origin/$branch
    fi
}

function update_project()
{
    branch=$1
    cd $HOME/git/ecma/puppy/$branch
    /usr/bin/git pull
}

function gitignore()
{
    branch=$1
    cd $HOME/git/ecma/puppy/$branch
    /opt/bin/cake gitignore
}

function deploy()
{
    branch=$1
    /puppy/bin/deploy $HOME/git/ecma/puppy/$branch
}

/bin/mkdir -p $HOME/git/ecma/puppy

maybe_clone common
maybe_clone private
maybe_clone protected
maybe_clone public
maybe_clone system
maybe_clone worker
maybe_clone job
maybe_clone appliances
maybe_clone vhosts
maybe_clone database
maybe_clone client
maybe_clone liminal
maybe_clone janitor

update_project common
update_project private
update_project protected
update_project public
update_project system
update_project worker
update_project job
update_project appliances
update_project vhosts
update_project database
update_project client
update_project liminal
update_project janitor

gitignore common
gitignore private
gitignore protected
gitignore public
gitignore system
gitignore worker
gitignore job
gitignore vhosts
gitignore database
gitignore client
gitignore liminal

$dir/../puppy/bin/deploy $dir/..

deploy system
deploy common
deploy private
deploy protected
deploy public
deploy worker
deploy job
deploy vhosts
deploy database
deploy client
deploy liminal
deploy janitor
