#!/bin/bash

cd $(dirname $0)
cd ..

echo "Building policy."
pushd selinux > /dev/null
output=$(/usr/bin/make -f /usr/share/selinux/devel/Makefile)
if [ $? -eq 0 ]
then
    echo "Reloading policy."
    /usr/bin/sudo /usr/sbin/semodule -i *.pp 
else
    echo $output
    exit 1
fi
popd > /dev/null

users=$(sudo /usr/sbin/semanage login -l | awk '/^[a-z]/ { print $1 }')

function assign_profile()
{
    user=$1
    echo users | grep user
    if [ $? -ne 0 ]
    then
        echo "Assigning profile "$user"_u to user $user"
    fi
}

mapped=$(/usr/bin/sudo /usr/sbin/semanage login -l | /bin/sed 1,3d | /bin/awk '{ print $1 }')
for user in public enqueue
do
    echo $mapped | grep '^'$user'$' > /dev/null
    if [ $? -ne 0 ]
    then
        sudo semanage login -a -s $user'_u' $user
    fi
done
